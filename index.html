<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AP Statistics Learning Resources</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Mermaid JS -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    
    <style>
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .tab-button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem 0.5rem 0 0;
            cursor: pointer;
        }
        .tab-button.active {
            background-color: #f0f9ff;
            border-bottom: 2px solid #3b82f6;
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-blue-600">AP Statistics Learning Resources</h1>
            <p class="text-gray-600 mt-2">Tools and guides to help you succeed in AP Statistics</p>
        </header>
        
        <!-- Tab Navigation -->
        <div class="flex mb-0 border-b border-gray-200">
            <div id="tab-learning-flow" class="tab-button active">Learning Flow</div>
            <div id="tab-flowchart" class="tab-button">Flowchart</div>
            <div id="tab-grok-prompt" class="tab-button">Grok Prompt</div>
            <div id="tab-study-materials" class="tab-button">Study Materials</div>
        </div>
        
        <!-- Tab Content -->
        <div class="bg-white rounded-b-lg shadow-md p-6">
            <!-- Learning Flow Tab -->
            <div id="content-learning-flow" class="tab-content active">
                <div id="learning-flow-app"></div>
            </div>
            
            <!-- Flowchart Tab -->
            <div id="content-flowchart" class="tab-content">
                <h2 class="text-xl font-bold mb-4">AP Statistics Learning Session Flowchart</h2>
                <p class="mb-4 text-gray-600">This flowchart shows the recommended learning process using your AP Statistics resources.</p>
                <div class="bg-gray-50 p-4 rounded-lg overflow-auto max-h-[80vh]">
                    <div class="mermaid" id="flowchart"></div>
                </div>
                <div class="mt-4 grid grid-cols-2 md:grid-cols-5 gap-2 text-sm">
                    <div class="p-2 rounded bg-blue-100 text-blue-800">Blue: Setup</div>
                    <div class="p-2 rounded bg-yellow-100 text-yellow-800">Yellow: Video Learning</div>
                    <div class="p-2 rounded bg-green-100 text-green-800">Green: Practice</div>
                    <div class="p-2 rounded bg-purple-100 text-purple-800">Purple: Progress</div>
                    <div class="p-2 rounded bg-red-100 text-red-800">Red: Capstone</div>
                </div>
            </div>
            
            <!-- Grok Prompt Tab -->
            <div id="content-grok-prompt" class="tab-content">
                <h2 class="text-xl font-bold mb-4">Grok AI Tutor Prompt</h2>
                <p class="mb-4">Copy and paste this prompt into Grok to set up your AI tutor:</p>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <pre id="grok-prompt" class="whitespace-pre-wrap text-sm"></pre>
                </div>
                <button id="copy-button" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">Copy to Clipboard</button>
            </div>
            
            <!-- Study Materials Tab -->
            <div id="content-study-materials" class="tab-content">
                <h2 class="text-xl font-bold mb-4">AP Statistics Study Materials</h2>
                <p class="mb-4">Select a topic to study. Download both PDFs and attach them to your Grok conversation.</p>
                
                <div class="mb-4">
                    <div class="flex items-center mb-2">
                        <label for="topic-select" class="mr-2 font-medium">Track your progress:</label>
                        <select id="topic-select" class="p-2 border rounded-md">
                            <option value="">Select a topic...</option>
                        </select>
                    </div>
                    <div id="progress-container" class="w-full bg-gray-200 rounded-full h-2.5 mb-4">
                        <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- All Topics Completed Message -->
                <div id="all-completed-container" class="hidden mb-6 p-6 bg-green-50 border border-green-200 rounded-lg text-center">
                    <h3 class="text-xl font-bold text-green-700 mb-2">üéâ Congratulations! üéâ</h3>
                    <p class="text-green-700 mb-4">You've completed all AP Statistics topics including the capstone AP Exam FRQ 6!</p>
                    <button id="reset-progress-btn" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                        Reset Progress
                    </button>
                </div>
                
                <div id="topic-cards-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Topic cards will be dynamically inserted here -->
                </div>
                
                <div id="next-topic-container" class="mt-6 p-4 bg-blue-50 rounded-lg hidden">
                    <h3 class="font-bold text-lg mb-2">Ready for the next topic?</h3>
                    <p class="mb-2">Great job completing the current topic! Here's what to study next:</p>
                    <div id="next-topic-card" class="p-4 bg-white rounded-lg shadow-md"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script>
        // Flowchart Mermaid Definition
        const flowchartDefinition = `flowchart TD
    A[Start Learning Session] --> B[Gather All Materials]
    B --> C[Open Grok AI Assistant]
    C --> D[Copy & Paste Tutor Prompt]
    D --> E[Open Study Materials Tab]
    E --> F[Download Question & Answer PDFs]
    F --> G[Attach PDFs to Grok Conversation]
    G --> H[Watch Topic Video]
    
    H --> I{Confused about\\nsomething?}
    I -->|Yes| J[Pause Video]
    J --> K[Ask Grok for Help]
    K --> L[Return to Video]
    L --> H
    
    I -->|No| M[Finish Video]
    M --> N[Work Through Practice Problems with Grok]
    N --> O{All Problems\\nCompleted?}
    O -->|No| N
    O -->|Yes| P[Mark Topic as Completed]
    P --> Q{All Topics\\nCompleted?}
    Q -->|No| R[Proceed to Next Topic]
    R --> E
    Q -->|Yes| S[Tackle Capstone Challenge]
    
    classDef blueBox fill:#d4f1f9,stroke:#05b2dc,stroke-width:2px;
    classDef greenBox fill:#d8f3dc,stroke:#2d6a4f,stroke-width:2px;
    classDef yellowBox fill:#fefae0,stroke:#bc6c25,stroke-width:2px;
    classDef purpleBox fill:#e0c3fc,stroke:#7b2cbf,stroke-width:2px;
    classDef redBox fill:#ffccd5,stroke:#d90429,stroke-width:2px;
    
    class A,B,C,D blueBox;
    class E,F,G blueBox;
    class H,I,J,K,L yellowBox;
    class M,N,O greenBox;
    class P,Q,R purpleBox;
    class S redBox;`;
        
        // Grok Prompt
        const grokPrompt = `You are an expert AP Statistics tutor. I will provide you with AP Statistics questions, which could be either multiple choice (MCQ) or free response (FRQ). For each question, I will indicate the type (MCQ or FRQ). Your task is to guide me through the questions as follows:

For MCQs:
- Present the Question: Display the multiple choice question with all answer options (A, B, C, D, E).
- Analyze My Answer: After I submit my answer:
  - If Correct: Confirm that my answer is correct and proceed to the next question.
  - If Incorrect: Identify my misconception and provide scaffolded guidance without revealing the answer.
- Provide Context (If Needed): For incorrect answers, once I arrive at the correct answer, provide relevant context.
- Summarize the Concept: Summarize the key concept being tested (only if I answered incorrectly).
- Check for Questions: Ask if I have additional questions before moving on (only if I needed guidance).

For FRQs:
- Present the Question: Display the free response question.
- Break It Down: Break down the question into smaller, scaffolded steps.
- Request Responses: For each scaffolded question, ask me to provide a response.
- Grade My Response: Evaluate my response based on the AP grading rubric.
- Guide Me: If my response is lacking, offer hints to help me improve.
- Ensure Perfection: Continue until I can provide a response that meets the rubric's requirements.
- Summarize the Concepts: Once completed correctly, summarize the key concepts.
- Check for Questions: Ask if I have additional questions before moving on.

Throughout the Session:
- Track Performance: Monitor my performance to provide personalized guidance.
- Session Summary: At the end, summarize key concepts and suggest areas for additional practice.

Thank you for helping me prepare for my AP Statistics exam!`;
        
        // Initialize Mermaid
        mermaid.initialize({ 
            startOnLoad: true, 
            theme: 'default',
            securityLevel: 'loose',
            logLevel: 5,
            flowchart: { 
                useMaxWidth: true, 
                htmlLabels: true,
                curve: 'cardinal',
                diagramPadding: 8,
                nodeSpacing: 30,
                rankSpacing: 50
            }
        });
        
        // Function to render the flowchart
        function renderFlowchart() {
            const container = document.getElementById('flowchart');
            
            // Remove all children and recreate the element
            while (container.firstChild) {
                container.removeChild(container.firstChild);
            }
            
            // Force re-parsing by creating and appending a new pre element
            const pre = document.createElement('pre');
            pre.className = 'mermaid';
            pre.textContent = flowchartDefinition;
            container.appendChild(pre);
            
            // Completely reinitialize mermaid for proper rendering
            try {
                mermaid.contentLoaded();
            } catch (e) {
                console.error('Mermaid parsing error:', e);
            }
        }
        
        // Study Materials and PDF Organization
        
        // Define the PDF files and organize them by topic
        const pdfFiles = [
            { 
                id: "4-8", 
                name: "Topic 4-8", 
                description: "Binomial and Geometric Random Variables",
                questionPdf: "4-8mcq.pdf",
                answersPdf: "4-8mcqAnswers.pdf",
                videoUrl: "https://apclassroom.collegeboard.org/d/qcoxl3r54z?sui=33,4",
                completed: false
            },
            { 
                id: "4-9", 
                name: "Topic 4-9", 
                description: "Transforming and Combining Random Variables",
                questionPdf: "4-9mcqfrq.pdf",
                answersPdf: "4-9mcqfrqAnswers.pdf",
                videoUrl: "https://apclassroom.collegeboard.org/d/fr03ec4ajm?sui=33,4",
                videoUrl2: "https://apclassroom.collegeboard.org/d/eekak8j8le?sui=33,4",
                completed: false
            },
            { 
                id: "5-5", 
                name: "Topic 5-5", 
                description: "Sampling Distributions for Means",
                questionPdf: "5-5mcq.pdf",
                answersPdf: "5-5mcqAnswers.pdf",
                videoUrl: "https://apclassroom.collegeboard.org/d/n68xwj4nrz?sui=33,5",
                videoUrl2: "https://apclassroom.collegeboard.org/d/3hds9p8qlq?sui=33,5",
                completed: false
            },
            { 
                id: "5-6", 
                name: "Topic 5-6", 
                description: "Central Limit Theorem",
                questionPdf: "5-6mcqfrq.pdf",
                answersPdf: "5-6mcqfrqAnswers.pdf",
                videoUrl: "https://apclassroom.collegeboard.org/d/hl9fyvkpih?sui=33,5",
                videoUrl2: "https://apclassroom.collegeboard.org/d/ik3wqrxnwg?sui=33,5",
                completed: false
            },
            { 
                id: "6-4", 
                name: "Topic 6-4", 
                description: "Confidence Intervals for Proportions",
                questionPdf: "6-4mcq.pdf",
                answersPdf: "6-4mcqAnswers.pdf",
                videoUrl: "https://apclassroom.collegeboard.org/d/pde094fkxp?sui=33,6",
                videoUrl2: "https://apclassroom.collegeboard.org/d/mg1k959s5t?sui=33,6",
                completed: false
            },
            { 
                id: "6-5", 
                name: "Topic 6-5", 
                description: "Confidence Intervals for Means",
                questionPdf: "6-5mcq.pdf",
                answersPdf: "6-5mcqAnswers.pdf",
                videoUrl: "https://apclassroom.collegeboard.org/d/xkvphnx7qu?sui=33,6",
                videoUrl2: "https://apclassroom.collegeboard.org/d/crg48hjihw?sui=33,6",
                completed: false
            },
            { 
                id: "6-10", 
                name: "Topic 6-10", 
                description: "Selecting an Appropriate Inference Procedure",
                questionPdf: "6-10mcq.pdf",
                answersPdf: "6-10mcqAnswers.pdf",
                videoUrl: "https://apclassroom.collegeboard.org/d/ycy5l5nclj?sui=33,6",
                videoUrl2: "https://apclassroom.collegeboard.org/d/etzlkyzo8u?sui=33,6",
                completed: false
            },
            {
                id: "exam-frq6",
                name: "AP Exam FRQ 6",
                description: "CAPSTONE: 2018 AP Exam Free Response Question 6",
                questionPdf: "2018APExamFRQ6-Question.pdf",
                answersPdf: "2018APExamFRQ6-Answer.pdf",
                isCapstone: true,
                completed: false
            }
        ];
        
        // Function to create a topic card
        function createTopicCard(topic, isNextTopic = false) {
            const card = document.createElement('div');
            
            // Special styling for capstone topic
            const isCapstone = topic.isCapstone === true;
            
            // Different styling based on topic type and completion status
            let cardClasses = 'p-4 rounded-lg shadow-md topic-card mb-2 ';
            if (topic.completed) {
                cardClasses += 'bg-green-50 border border-green-200';
            } else if (isCapstone) {
                cardClasses += 'bg-yellow-50 border border-yellow-200';
            } else if (isNextTopic || topic.current) {
                cardClasses += 'bg-blue-50 border border-blue-200';
            } else {
                cardClasses += 'bg-white';
            }
            
            card.className = cardClasses;
            card.id = `topic-card-${topic.id}`;
            
            // Status icon varies by completion and type
            let statusIcon = '';
            if (topic.completed) {
                statusIcon = '<span class="text-green-500 mr-2">‚úì</span>';
            } else if (isNextTopic || topic.current) {
                statusIcon = '<span class="text-blue-500 mr-2">‚Üí</span>';
            } else if (isCapstone) {
                statusIcon = '<span class="text-yellow-500 mr-2">üèÜ</span>';
            } else {
                statusIcon = '<span class="text-gray-300 mr-2">‚óã</span>';
            }
            
            // Status badge text and style
            let badgeClass = topic.completed 
                ? 'bg-green-100 text-green-800' 
                : isCapstone 
                  ? 'bg-yellow-100 text-yellow-800'
                  : isNextTopic || topic.current
                  ? 'bg-blue-100 text-blue-800'
                  : 'bg-gray-100 text-gray-800';
            
            let badgeText = topic.completed 
                ? 'Completed' 
                : isCapstone 
                  ? 'Final Challenge'
                  : isNextTopic || topic.current
                  ? 'Current Focus'
                  : 'Upcoming';
            
            card.innerHTML = `
                <div class="flex justify-between items-start mb-3">
                    <h3 class="font-bold text-lg">${statusIcon}${topic.name}</h3>
                    <span class="px-2 py-1 text-xs rounded-full ${badgeClass}">
                        ${badgeText}
                    </span>
                </div>
                <p class="text-gray-700 mb-3">${topic.description}</p>
                <div class="flex flex-col gap-2">
                    <a href="${topic.questionPdf}" target="_blank" class="flex items-center text-blue-600 hover:text-blue-800">
                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Download Questions PDF (for Grok)
                    </a>
                    <a href="${topic.answersPdf}" target="_blank" class="flex items-center text-blue-600 hover:text-blue-800">
                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Download Answers PDF (for Grok)
                    </a>
                    ${topic.videoUrl ? `
                    <a href="${topic.videoUrl}" target="_blank" class="flex items-center text-purple-600 hover:text-purple-800">
                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"></path>
                        </svg>
                        Watch Topic Video ${topic.videoUrl2 ? '1' : ''}
                    </a>
                    ` : ''}
                    ${topic.videoUrl2 ? `
                    <a href="${topic.videoUrl2}" target="_blank" class="flex items-center text-purple-600 hover:text-purple-800">
                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"></path>
                        </svg>
                        Watch Topic Video 2
                    </a>
                    ` : ''}
                    ${isNextTopic || topic.current ? `
                    <div class="mt-2 p-2 bg-blue-100 text-blue-800 text-sm rounded flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        <span>This is your current focus topic</span>
                    </div>
                    ` : ''}
                    ${!topic.completed ? `
                    <button 
                        class="mt-2 px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600"
                        onclick="markTopicAsCompleted('${topic.id}')"
                    >
                        Mark as Completed
                    </button>
                    ` : ''}
                    ${isCapstone && !topic.completed ? `
                    <div class="mt-2 p-2 bg-yellow-100 text-yellow-800 text-sm rounded">
                        <strong>Capstone Challenge!</strong> Complete all previous topics before attempting this final challenge.
                    </div>
                    ` : ''}
                </div>
            `;
            
            return card;
        }
        
        // Add styling for the pulse animation and completed state
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
                70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
                100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
            }
            
            .pulse-animation {
                animation: pulse 1s ease-in-out 2;
            }
            
            .completed-state {
                opacity: 0.8;
                position: relative;
            }
            
            .completed-state::after {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.05);
                pointer-events: none;
                z-index: 1;
            }
            
            .completed-state .topic-card:not(.capstone-completed) {
                filter: grayscale(50%);
            }
            
            .capstone-highlight {
                box-shadow: 0 0 15px rgba(217, 4, 41, 0.5);
                transform: scale(1.02);
                transition: all 0.3s ease;
            }
        `;
        document.head.appendChild(style);
        
        // Function to check if all topics are completed
        function checkAllTopicsCompleted() {
            const allCompleted = pdfFiles.every(topic => topic.completed);
            const completedContainer = document.getElementById('all-completed-container');
            const topicCardsContainer = document.getElementById('topic-cards-container');
            const studyMaterialsTab = document.getElementById('content-study-materials');
            
            if (allCompleted) {
                // Show completion message
                completedContainer.classList.remove('hidden');
                
                // Hide the next topic container
                document.getElementById('next-topic-container').classList.add('hidden');
                
                // Add completed state styling to the cards container
                topicCardsContainer.classList.add('completed-state');
                
                // Find the capstone topic card and highlight it
                const capstoneCard = document.getElementById(`topic-card-exam-frq6`);
                if (capstoneCard) {
                    capstoneCard.classList.add('capstone-highlight');
                }
                
                // Add a subtle completion state to the entire tab
                studyMaterialsTab.classList.add('bg-green-50');
            } else {
                // Hide completion message
                completedContainer.classList.add('hidden');
                
                // Remove completed state styling
                topicCardsContainer.classList.remove('completed-state');
                studyMaterialsTab.classList.remove('bg-green-50');
                
                // Remove capstone highlight
                const capstoneCard = document.getElementById(`topic-card-exam-frq6`);
                if (capstoneCard) {
                    capstoneCard.classList.remove('capstone-highlight');
                }
            }
            
            return allCompleted;
        }
        
        // Function to reset all progress
        function resetProgress() {
            // Confirm reset
            if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
                // Reset all topics to not completed
                pdfFiles.forEach((topic, index) => {
                    topic.completed = false;
                    topic.current = index === 0; // Set first topic as current
                });
                
                // Save to local storage
                saveTopicProgress();
                
                // Refresh the UI
                populateTopicCards();
                
                // Hide completion message
                document.getElementById('all-completed-container').classList.add('hidden');
                
                // Scroll to the first topic
                const firstCard = document.getElementById(`topic-card-${pdfFiles[0].id}`);
                if (firstCard) {
                    firstCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        }
        
        // Function to populate the topic cards
        function populateTopicCards() {
            const container = document.getElementById('topic-cards-container');
            container.innerHTML = '';
            
            // Find the first incomplete topic
            const nextIncompleteIndex = pdfFiles.findIndex(topic => !topic.completed);
            
            // Mark it as current unless all topics are completed
            if (nextIncompleteIndex >= 0) {
                pdfFiles.forEach((topic, index) => {
                    topic.current = index === nextIncompleteIndex;
                });
            }
            
            // Populate the cards in the original order (sequential)
            pdfFiles.forEach((topic, index) => {
                const isNext = index === nextIncompleteIndex;
                const card = createTopicCard(topic, isNext);
                container.appendChild(card);
            });
            
            updateProgressBar();
            populateTopicSelect();
            checkAllTopicsCompleted();
        }
        
        // Function to populate the topic select dropdown
        function populateTopicSelect() {
            const select = document.getElementById('topic-select');
            select.innerHTML = '<option value="">Select a topic...</option>';
            
            pdfFiles.forEach(topic => {
                const option = document.createElement('option');
                option.value = topic.id;
                option.textContent = topic.name;
                select.appendChild(option);
            });
            
            // Add event listener to handle selection
            select.addEventListener('change', function() {
                const selectedTopicId = this.value;
                if (!selectedTopicId) return;
                
                // Scroll to the selected topic card
                const card = document.getElementById(`topic-card-${selectedTopicId}`);
                if (card) {
                    card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    card.classList.add('pulse-animation');
                    setTimeout(() => {
                        card.classList.remove('pulse-animation');
                    }, 2000);
                }
            });
        }
        
        // Function to mark a topic as completed
        function markTopicAsCompleted(topicId) {
            const topic = pdfFiles.find(t => t.id === topicId);
            if (topic) {
                topic.completed = true;
                topic.current = false;
                
                // Automatically mark the next topic as current
                const currentIndex = pdfFiles.findIndex(t => t.id === topicId);
                if (currentIndex >= 0 && currentIndex < pdfFiles.length - 1) {
                    const nextTopic = pdfFiles[currentIndex + 1];
                    if (nextTopic) {
                        nextTopic.current = true;
                    }
                }
                
                // Update local storage to persist completion status
                saveTopicProgress();
                
                // Refresh the UI
                populateTopicCards();
                
                // If a topic was completed, scroll to the next one
                if (currentIndex < pdfFiles.length - 1) {
                    const nextCard = document.getElementById(`topic-card-${pdfFiles[currentIndex + 1].id}`);
                    if (nextCard) {
                        setTimeout(() => {
                            nextCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }, 100);
                    }
                }
            }
        }
        
        // Function to update the next topic section
        function updateNextTopic() {
            const nextTopicContainer = document.getElementById('next-topic-container');
            const nextTopicCard = document.getElementById('next-topic-card');
            
            // Check if all topics are completed
            if (checkAllTopicsCompleted()) {
                nextTopicContainer.classList.add('hidden');
                return;
            }
            
            // Find the first incomplete topic
            const nextIncompleteIndex = pdfFiles.findIndex(topic => !topic.completed);
            
            if (nextIncompleteIndex >= 0) {
                nextTopicContainer.classList.remove('hidden');
                nextTopicCard.innerHTML = '';
                nextTopicCard.appendChild(createTopicCard(pdfFiles[nextIncompleteIndex], true));
            } else {
                nextTopicContainer.classList.add('hidden');
            }
        }
        
        // Function to update the progress bar
        function updateProgressBar() {
            const completedCount = pdfFiles.filter(topic => topic.completed).length;
            const totalCount = pdfFiles.length;
            const progressPercentage = totalCount > 0 ? (completedCount / totalCount) * 100 : 0;
            
            const progressBar = document.getElementById('progress-bar');
            progressBar.style.width = `${progressPercentage}%`;
            
            // Add text to the progress bar if it's big enough
            if (progressPercentage > 10) {
                progressBar.textContent = `${Math.round(progressPercentage)}% Complete`;
            } else {
                progressBar.textContent = '';
            }
        }
        
        // Function to save topic progress to local storage
        function saveTopicProgress() {
            const progress = pdfFiles.map(topic => ({
                id: topic.id,
                completed: topic.completed,
                current: topic.current,
                videoUrl: topic.videoUrl,
                videoUrl2: topic.videoUrl2
            }));
            
            localStorage.setItem('apStatsTopicProgress', JSON.stringify(progress));
        }
        
        // Function to load topic progress from local storage
        function loadTopicProgress() {
            const savedProgress = localStorage.getItem('apStatsTopicProgress');
            
            if (savedProgress) {
                const progress = JSON.parse(savedProgress);
                
                // Update the pdfFiles array with saved progress
                progress.forEach(savedTopic => {
                    const topic = pdfFiles.find(t => t.id === savedTopic.id);
                    if (topic) {
                        topic.completed = savedTopic.completed;
                        topic.current = savedTopic.current;
                        
                        // Preserve video URLs if they exist
                        if (savedTopic.videoUrl) {
                            topic.videoUrl = savedTopic.videoUrl;
                        }
                        if (savedTopic.videoUrl2) {
                            topic.videoUrl2 = savedTopic.videoUrl2;
                        }
                    }
                });
            }
        }
        
        // Document ready function
        document.addEventListener('DOMContentLoaded', function() {
            // Set Grok prompt content
            document.getElementById('grok-prompt').textContent = grokPrompt;
            
            // Tab Switching Logic
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    // Update active tab button
                    document.querySelectorAll('.tab-button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    button.classList.add('active');
                    
                    // Update active content
                    const contentId = button.id.replace('tab-', 'content-');
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(contentId).classList.add('active');
                    
                    // Always render mermaid chart if flowchart tab, whether it was previously active or not
                    if (button.id === 'tab-flowchart') {
                        // Small delay to ensure the tab content is visible before rendering
                        setTimeout(renderFlowchart, 50);
                    }
                    
                    // Initialize topic cards if study materials tab
                    if (button.id === 'tab-study-materials') {
                        loadTopicProgress();
                        populateTopicCards();
                    }
                });
            });
            
            // Copy to clipboard functionality
            document.getElementById('copy-button').addEventListener('click', () => {
                const promptText = document.getElementById('grok-prompt').textContent;
                
                // Use the Clipboard API with fallback methods
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    // Modern browsers
                    navigator.clipboard.writeText(promptText)
                        .then(() => {
                            const button = document.getElementById('copy-button');
                            button.textContent = 'Copied!';
                            button.classList.add('bg-green-500');
                            button.classList.remove('bg-blue-500');
                            
                            setTimeout(() => {
                                button.textContent = 'Copy to Clipboard';
                                button.classList.add('bg-blue-500');
                                button.classList.remove('bg-green-500');
                            }, 2000);
                        })
                        .catch(err => {
                            console.error('Failed to copy text: ', err);
                            alert('Failed to copy to clipboard. Please select and copy the text manually.');
                        });
                } else {
                    // Fallback for older browsers
                    try {
                        // Create a temporary textarea element
                        const textarea = document.createElement('textarea');
                        textarea.value = promptText;
                        textarea.setAttribute('readonly', '');
                        textarea.style.position = 'absolute';
                        textarea.style.left = '-9999px';
                        document.body.appendChild(textarea);
                        
                        // Select and copy the text
                        textarea.select();
                        document.execCommand('copy');
                        
                        // Remove the textarea
                        document.body.removeChild(textarea);
                        
                        // Update button styles
                        const button = document.getElementById('copy-button');
                        button.textContent = 'Copied!';
                        button.classList.add('bg-green-500');
                        button.classList.remove('bg-blue-500');
                        
                        setTimeout(() => {
                            button.textContent = 'Copy to Clipboard';
                            button.classList.add('bg-blue-500');
                            button.classList.remove('bg-green-500');
                        }, 2000);
                    } catch (err) {
                        console.error('Failed to copy text: ', err);
                        alert('Failed to copy to clipboard. Please select and copy the text manually.');
                    }
                }
            });
            
            // Reset progress button functionality
            document.getElementById('reset-progress-btn').addEventListener('click', resetProgress);
            
            // Auto-render flowchart if that tab is initially selected
            if (document.getElementById('tab-flowchart').classList.contains('active')) {
                renderFlowchart();
            }
            
            // Initialize study materials if that tab is initially selected
            if (document.getElementById('tab-study-materials').classList.contains('active')) {
                loadTopicProgress();
                populateTopicCards();
            }
        });
        
        // Make the topic functions available globally
        window.markTopicAsCompleted = markTopicAsCompleted;
    </script>
    
    <!-- React Component -->
    <script type="text/babel">
        const APStatLearningFlow = () => {
          const [currentStep, setCurrentStep] = React.useState(0);
          
          const steps = [
            {
              title: "1. Set Up",
              icon: "üìù",
              content: "Gather all your materials before starting your AP Statistics learning session",
              tips: ["Find a quiet place to focus", "Make sure your laptop is charged", "Have your calculator and formula sheet ready"]
            },
            {
              title: "2. Prepare Grok",
              icon: "ü§ñ",
              content: "Open Grok, set up the AI tutor, and download the corresponding PDFs from Study Materials",
              tips: ["Copy the provided AP Statistics tutor prompt", "Attach both question and answer PDFs to your Grok conversation"]
            },
            {
              title: "3. Watch Video",
              icon: "üì∫",
              content: "Actively watch the video lesson for your current topic",
              tips: ["Take notes on paper", "Work through every example shown", "Videos are linked in the Study Materials tab"]
            },
            {
              title: "4. Ask Questions",
              icon: "‚ùì",
              content: "If you get confused during the video, pause and ask Grok for help",
              tips: ["Be specific about what confused you", "Return to the video once you understand"]
            },
            {
              title: "5. Practice Problems",
              icon: "üß©",
              content: "After the video, use Grok to work through the practice problems",
              tips: ["Grok will guide you through all questions", "Use the answer PDF to verify your work"]
            },
            {
              title: "6. Track Progress",
              icon: "‚úÖ",
              content: "Mark the topic as completed once you've mastered it",
              tips: ["The next topic will automatically become your focus", "Complete all topics before attempting the capstone challenge"]
            }
          ];
          
          const handlePrev = () => {
            setCurrentStep(prev => Math.max(0, prev - 1));
          };
          
          const handleNext = () => {
            setCurrentStep(prev => Math.min(steps.length - 1, prev + 1));
          };

          return (
            <div className="flex flex-col bg-gray-50 p-4 rounded-lg max-w-4xl mx-auto">
              <h1 className="text-2xl font-bold text-center mb-6">AP Statistics: Using Grok to Help You Learn</h1>
              
              {/* Progress Tracker */}
              <div className="flex flex-wrap justify-between mb-8">
                {steps.map((step, idx) => (
                  <div 
                    key={idx} 
                    className={`flex flex-col items-center cursor-pointer mb-2 ${idx <= currentStep ? 'text-blue-600' : 'text-gray-400'}`}
                    onClick={() => setCurrentStep(idx)}
                  >
                    <div className={`w-12 h-12 rounded-full flex items-center justify-center text-xl mb-2 ${idx <= currentStep ? 'bg-blue-100' : 'bg-gray-200'}`}>
                      {step.icon}
                    </div>
                    <div className="text-xs font-medium text-center w-20">{step.title}</div>
                  </div>
                ))}
              </div>
              
              {/* Step Content */}
              <div className="bg-white p-6 rounded-lg shadow-md mb-6">
                <h2 className="text-xl font-bold mb-4">{steps[currentStep].title}</h2>
                <p className="mb-4">{steps[currentStep].content}</p>
                
                <div className="bg-blue-50 p-4 rounded-lg">
                  <h3 className="font-bold text-blue-800 mb-2">Pro Tips:</h3>
                  <ul className="list-disc pl-5">
                    {steps[currentStep].tips.map((tip, idx) => (
                      <li key={idx} className="mb-1">{tip}</li>
                    ))}
                  </ul>
                </div>
              </div>
              
              {/* Materials List (visible on all screens) */}
              <div className="bg-white p-4 rounded-lg shadow-md mb-6">
                <h3 className="font-bold mb-2">Materials Needed:</h3>
                <div className="grid grid-cols-2 sm:grid-cols-3 gap-2">
                  <div className="flex items-center"><span className="mr-2">üìÑ</span> Paper</div>
                  <div className="flex items-center"><span className="mr-2">‚úèÔ∏è</span> Pencil</div>
                  <div className="flex items-center"><span className="mr-2">üßÆ</span> Calculator</div>
                  <div className="flex items-center"><span className="mr-2">üíª</span> Laptop</div>
                  <div className="flex items-center"><span className="mr-2">üéß</span> Headphones (optional)</div>
                  <div className="flex items-center"><span className="mr-2">üìã</span> Clipboard</div>
                  <div className="flex items-center"><span className="mr-2">üìë</span> AP Exam Formula Sheet</div>
                </div>
              </div>
              
              {/* Video Note */}
              <div className="bg-yellow-50 p-4 rounded-lg shadow-md mb-6">
                <h3 className="font-bold text-yellow-800 mb-2">About the Videos:</h3>
                <p>Links to AP Classroom videos for each topic have been provided in Schoology during the time the material was presented. Google Drive copies of these videos are available through the links in Schoology.</p>
              </div>
              
              {/* Navigation Buttons */}
              <div className="flex justify-between">
                <button 
                  onClick={handlePrev} 
                  className={`px-4 py-2 rounded-lg ${currentStep === 0 ? 'bg-gray-200 text-gray-500' : 'bg-blue-500 text-white'}`}
                  disabled={currentStep === 0}
                >
                  Previous Step
                </button>
                <button 
                  onClick={handleNext} 
                  className={`px-4 py-2 rounded-lg ${currentStep === steps.length - 1 ? 'bg-gray-200 text-gray-500' : 'bg-blue-500 text-white'}`}
                  disabled={currentStep === steps.length - 1}
                >
                  Next Step
                </button>
              </div>
            </div>
          );
        };

        // Render React component
        ReactDOM.render(<APStatLearningFlow />, document.getElementById('learning-flow-app'));
    </script>
</body>
</html> 